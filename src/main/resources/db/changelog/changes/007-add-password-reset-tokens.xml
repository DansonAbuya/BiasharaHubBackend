<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="007-add-password-reset-tokens" author="biasharahub">
        <comment>Add password_reset_tokens table to tenant_default for forgot-password flow</comment>
        <sql>
            CREATE TABLE IF NOT EXISTS tenant_default.password_reset_tokens (
                token_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                user_id UUID NOT NULL REFERENCES tenant_default.users(user_id) ON DELETE CASCADE,
                token VARCHAR(255) NOT NULL UNIQUE,
                expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
                created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
            );
            CREATE INDEX IF NOT EXISTS idx_password_reset_tokens_token ON tenant_default.password_reset_tokens(token);
            CREATE INDEX IF NOT EXISTS idx_password_reset_tokens_expires ON tenant_default.password_reset_tokens(expires_at);
        </sql>
    </changeSet>

</databaseChangeLog>
